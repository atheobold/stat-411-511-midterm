---
title: "Take-Home Midterm"
author: "Your Name Here!"
date: "10/7/2019"
output: pdf_document
---

General instructions:  

* Be sure that figures and tables are clearly labeled and captioned – this may 
mean not using R defaults!
* When in doubt, answer with a sentence; streams of code and output **do not** 
constitute a complete answer.
* And finally, all work should be your own – no discussion or collaboration with classmates.


# Question 1 (Two Sample Data)  

In 2012 data were obtained on 10,933 Okcupid users' profiles. Okcupid is a free 
dating website, designed by mathematicians, which today has over 112,000 users,
boasts that over 7.3 million messages per day, and prides themselves on the 
inclusive nature of their website (all users are welcome).  

The profiles.csv dataset provides an assortment of self reported (user input) 
variables:    

* age
* body type
* education
* ethnicity
* height (in inches)
* income
* job type
* sexual orientation
* religion
* sexual identity
* zodiac sign
* marital status

Data analytics at Okcupid uses these data to make the best possible "matches". 
The data scientists are interested if men's self reported heights differ by 
sexual orientation.  


## Part One 

Use the following code to read in the data. 

```{r, warning = FALSE, message = FALSE}
library(tidyverse)
## Change the code below to specify the correct path to load in the data 
profiles <- read_csv("data/profiles.csv")

```

__Provide a description of the process being executed in the code below.__ 
__(e.g. What procedure is occurring on each line of code?)__ 
<!-- Your response here! Do not delete this line! -->




```{r}
male_profiles <- profiles %>% 
                  filter(sex == "m", orientation != "bisexual", 
                         height > 48, height < 84) %>% 
                  select(height, orientation) 
```


## Part Two 

Using the male_profiles dataset, create visualizations of the distribution of 
heights for men who identify as straight and those who identify as gay. Make 
sure that your plot has:  

* nice axis labels  
* a nice title 

```{r}
## Your code to generate a plot of the distribution of heights for straight and 
## gay men goes here!  

male_profiles %>% 
  ggplot(aes(x = orientation, y = height)) + 
  geom_violin(aes(color = orientation)) + 
  theme(legend.position = "none") + 
  labs(x = "Self-Identified Sexual Orientation", 
       y = "Self-Reported Height (inches)") + 
  ggtitle("Differences in Self-Reported Height between Straight and Gay Males")

```

Interpret what you see in the plot you created. Be sure you reference the correct
order of subtraction used!  
<!-- Your response here! Do not delete this line! -->




## Part Three 

The data scientists at OkCupid chose to analyze these data using a permutation 
test for a difference in mean self-reported height.   

__Do you agree with their decision? Why or why not?__  
__Be sure to reference the plot you created in Part Two!__ 
<!-- Your response here! Do not delete this line! -->




## Part Four  

Using the male_profiles dataset, carry out a permutation test for a difference 
in mean self-reported height for men who identify as straight and those who 
identify as gay.  

```{r, cache = TRUE}
## Your code to carry out a permutation test for a difference in means goes here!  
library(infer)

diff_mean <- male_profiles %>% 
  specify(height ~ orientation) %>% 
  calculate(stat = "diff in means", 
            order = c("straight", "gay")
            )

permutations <- male_profiles %>% 
  specify(height ~ orientation) %>% 
  hypothesize(null = "independence") %>% 
  generate(type = "permute", reps = 5000) %>% 
  calculate(stat = "diff in means", 
            order = c("straight", "gay")
  )
  
get_p_value(permutations, diff_mean, direction = "two_sided")

permutations %>% 
  visualise(method = "simulation") + 
  shade_p_value(diff_mean, 
                direction = "two_sided", 
                color = "red", 
                fill = "pink")
```

## Part Five  

Based on the results of your permutation test, create a *Results* and 
*Conclusions* section for a statistical report for these data and research 
question.  

__Results__ 
<!-- Your response here! Do not delete this line! -->




__Conclusion__ 
<!-- Your response here! Do not delete this line! -->




# Question 2 (Paired Data)

Data on the number of males and females who entered in the New York City marathon 
have been recorded every year since 1978. These data are provided in the 
ny-marathon-2016.txt file. Social scientists are interested in if over this time
period, a larger number of males register for the NYC marathon than women. 

## Part One 

Use the following code to read in the data. 

```{r, message = FALSE}
marathon <- read_tsv("data/ny-marathon-2016.txt")

```

__What is the mutate() function doing in the code below.__ 
__(e.g. How is it modifying the marathon dataset?)__ 


```{r}
marathon <- marathon %>% 
            rename(Male = Men, Female = Women) %>% 
            mutate(Diff = Male - Female)
```

<!-- Your response here! Do not delete this line! -->




## Part Two 

Create a visualization of how the distribution of differences in the number of 
male and female runners over the last 40 years. Make sure that your plot has:  

* nice axis labels
* a nice title

```{r, warning = FALSE}
## Your code to generate a plot of the distribution of differences in male and 
## female NYC runners goes here!  

marathon %>% 
  ggplot(aes(x = Diff)) + 
  geom_density(fill = "tomato")

```

Interpret what you see in the plot you created. Be sure you reference the correct
order of subtraction used!  
<!-- Your response here! Do not delete this line! -->




## Part Three 

Using the plot you created in Part Two and the Q-Q plot below, assess whether 
the assumptions of conducting a t-test are violated. Be sure to address **every**
assumption associated with conducting a t-test. Justify your decisions based on 
the information provided about these data and the visualizations. 

```{r}
run_lm <- lm(Diff ~ 1, data = marathon)
plot(run_lm, which = 2)

```
<!-- Your response here! Do not delete this line! -->




## Part Four  

Using the marathon dataset, carry out a t-test to investigate if, over this time
period, a larger number of males register for the NYC marathon than women. 

```{r}
## Your code to carry out a t-test for a single mean goes here!  


```


## Part Five 

Based on the results of your permutation test, create a *Results* and 
*Conclusions* section for a statistical report for these data and research 
question.  

__Results__ 
<!-- Your response here! Do not delete this line! -->




__Conclusion__ 
<!-- Your response here! Do not delete this line! -->






